(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4d5c7541"],{"00d87":function(e,t){(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,a=0;n<e.length;n++,a+=8)t[a>>>5]|=e[n]<<24-a%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){for(var n=[],a=0;a<e.length;a+=3)for(var r=e[a]<<16|e[a+1]<<8|e[a+2],o=0;o<4;o++)8*a+6*o<=8*e.length?n.push(t.charAt(r>>>6*(3-o)&63)):n.push("=");return n.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],a=0,r=0;a<e.length;r=++a%4)0!=r&&n.push((t.indexOf(e.charAt(a-1))&Math.pow(2,-2*r+8)-1)<<2*r|t.indexOf(e.charAt(a))>>>6-2*r);return n}};e.exports=n})()},"5f6d":function(e,t,n){},6537:function(e,t,n){"use strict";var a=n("d405"),r=n.n(a);r.a},"6821f":function(e,t,n){(function(){var t=n("00d87"),a=n("9a63").utf8,r=n("044b"),o=n("9a63").bin,s=function(e,n){e.constructor==String?e=n&&"binary"===n.encoding?o.stringToBytes(e):a.stringToBytes(e):r(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||(e=e.toString());for(var i=t.bytesToWords(e),c=8*e.length,l=1732584193,h=-271733879,u=-1732584194,p=271733878,d=0;d<i.length;d++)i[d]=16711935&(i[d]<<8|i[d]>>>24)|4278255360&(i[d]<<24|i[d]>>>8);i[c>>>5]|=128<<c%32,i[14+(c+64>>>9<<4)]=c;var m=s._ff,f=s._gg,b=s._hh,v=s._ii;for(d=0;d<i.length;d+=16){var k=l,_=h,g=u,F=p;l=m(l,h,u,p,i[d+0],7,-680876936),p=m(p,l,h,u,i[d+1],12,-389564586),u=m(u,p,l,h,i[d+2],17,606105819),h=m(h,u,p,l,i[d+3],22,-1044525330),l=m(l,h,u,p,i[d+4],7,-176418897),p=m(p,l,h,u,i[d+5],12,1200080426),u=m(u,p,l,h,i[d+6],17,-1473231341),h=m(h,u,p,l,i[d+7],22,-45705983),l=m(l,h,u,p,i[d+8],7,1770035416),p=m(p,l,h,u,i[d+9],12,-1958414417),u=m(u,p,l,h,i[d+10],17,-42063),h=m(h,u,p,l,i[d+11],22,-1990404162),l=m(l,h,u,p,i[d+12],7,1804603682),p=m(p,l,h,u,i[d+13],12,-40341101),u=m(u,p,l,h,i[d+14],17,-1502002290),h=m(h,u,p,l,i[d+15],22,1236535329),l=f(l,h,u,p,i[d+1],5,-165796510),p=f(p,l,h,u,i[d+6],9,-1069501632),u=f(u,p,l,h,i[d+11],14,643717713),h=f(h,u,p,l,i[d+0],20,-373897302),l=f(l,h,u,p,i[d+5],5,-701558691),p=f(p,l,h,u,i[d+10],9,38016083),u=f(u,p,l,h,i[d+15],14,-660478335),h=f(h,u,p,l,i[d+4],20,-405537848),l=f(l,h,u,p,i[d+9],5,568446438),p=f(p,l,h,u,i[d+14],9,-1019803690),u=f(u,p,l,h,i[d+3],14,-187363961),h=f(h,u,p,l,i[d+8],20,1163531501),l=f(l,h,u,p,i[d+13],5,-1444681467),p=f(p,l,h,u,i[d+2],9,-51403784),u=f(u,p,l,h,i[d+7],14,1735328473),h=f(h,u,p,l,i[d+12],20,-1926607734),l=b(l,h,u,p,i[d+5],4,-378558),p=b(p,l,h,u,i[d+8],11,-2022574463),u=b(u,p,l,h,i[d+11],16,1839030562),h=b(h,u,p,l,i[d+14],23,-35309556),l=b(l,h,u,p,i[d+1],4,-1530992060),p=b(p,l,h,u,i[d+4],11,1272893353),u=b(u,p,l,h,i[d+7],16,-155497632),h=b(h,u,p,l,i[d+10],23,-1094730640),l=b(l,h,u,p,i[d+13],4,681279174),p=b(p,l,h,u,i[d+0],11,-358537222),u=b(u,p,l,h,i[d+3],16,-722521979),h=b(h,u,p,l,i[d+6],23,76029189),l=b(l,h,u,p,i[d+9],4,-640364487),p=b(p,l,h,u,i[d+12],11,-421815835),u=b(u,p,l,h,i[d+15],16,530742520),h=b(h,u,p,l,i[d+2],23,-995338651),l=v(l,h,u,p,i[d+0],6,-198630844),p=v(p,l,h,u,i[d+7],10,1126891415),u=v(u,p,l,h,i[d+14],15,-1416354905),h=v(h,u,p,l,i[d+5],21,-57434055),l=v(l,h,u,p,i[d+12],6,1700485571),p=v(p,l,h,u,i[d+3],10,-1894986606),u=v(u,p,l,h,i[d+10],15,-1051523),h=v(h,u,p,l,i[d+1],21,-2054922799),l=v(l,h,u,p,i[d+8],6,1873313359),p=v(p,l,h,u,i[d+15],10,-30611744),u=v(u,p,l,h,i[d+6],15,-1560198380),h=v(h,u,p,l,i[d+13],21,1309151649),l=v(l,h,u,p,i[d+4],6,-145523070),p=v(p,l,h,u,i[d+11],10,-1120210379),u=v(u,p,l,h,i[d+2],15,718787259),h=v(h,u,p,l,i[d+9],21,-343485551),l=l+k>>>0,h=h+_>>>0,u=u+g>>>0,p=p+F>>>0}return t.endian([l,h,u,p])};s._ff=function(e,t,n,a,r,o,s){var i=e+(t&n|~t&a)+(r>>>0)+s;return(i<<o|i>>>32-o)+t},s._gg=function(e,t,n,a,r,o,s){var i=e+(t&a|n&~a)+(r>>>0)+s;return(i<<o|i>>>32-o)+t},s._hh=function(e,t,n,a,r,o,s){var i=e+(t^n^a)+(r>>>0)+s;return(i<<o|i>>>32-o)+t},s._ii=function(e,t,n,a,r,o,s){var i=e+(n^(t|~a))+(r>>>0)+s;return(i<<o|i>>>32-o)+t},s._blocksize=16,s._digestsize=16,e.exports=function(e,n){if(void 0===e||null===e)throw new Error("Illegal argument "+e);var a=t.wordsToBytes(s(e,n));return n&&n.asBytes?a:n&&n.asString?o.bytesToString(a):t.bytesToHex(a)}})()},"9a63":function(e,t){var n={utf8:{stringToBytes:function(e){return n.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(n.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}};e.exports=n},"9f14":function(e,t,n){},a288:function(e,t,n){"use strict";var a=n("9f14"),r=n.n(a);r.a},bcfb:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Task",{attrs:{taskModal:e.taskModal},on:{refreshTaskList:e.refreshTaskList,switchTaskModal:e.switchTaskModal}}),n("span",{staticClass:"demo-affix",on:{click:function(){e.drawerShow=!0}}},[n("Icon",{staticStyle:{"font-size":"13px"},attrs:{type:"md-lock"}}),n("b",[e._v("环境锁")])],1),n("EnvLock",{attrs:{pdrawerShow:e.drawerShow},on:{switchdrawerShow:e.switchdrawerShow}}),n("Card",[n("p",{staticStyle:{"font-size":"13px",color:"#909399"},attrs:{slot:"title"},slot:"title"},[e._v("发布信息\n    ")]),n("Row",[n("Col",{attrs:{span:"5",offset:""}},[n("Form",{attrs:{inline:""}},[n("FormItem",[n("Button",{attrs:{icon:"md-paper-plane",type:"success",ghost:""},on:{click:function(){e.taskModal=!0}}},[e._v("\n              发布 | 回滚\n            ")])],1),n("FormItem",[n("Poptip",{attrs:{placement:"right-start",width:600},on:{"on-popper-show":e.taskStatusShow,"on-popper-hide":e.taskStatusHide}},[n("Button",{attrs:{type:"info",icon:"ios-timer-outline",ghost:""}},[e._v("待完成任务")]),n("div",{attrs:{slot:"content"},slot:"content"},[n("Alert",[e._v("自动刷新，间隔15s。\n                  "),n("div",{staticClass:"demo-spin-col",staticStyle:{width:"10%",height:"10%",float:"right","margin-top":"8px"}},[n("Spin",{attrs:{fix:""}},[n("Icon",{staticClass:"demo-spin-icon-load",attrs:{type:"ios-loading",size:"18"}})],1)],1)]),n("Table",{attrs:{columns:e.statusColumns,data:e.statusDatas,loading:e.statusTableLoading}})],1)],1)],1)],1)],1),n("Col",{attrs:{span:"2",offset:"17"}},[n("Tooltip",{staticStyle:{"margin-left":"20px"},attrs:{content:"刷新发布列表, 频率: 60s",placement:"left"}},[n("Button",{directives:[{name:"show",rawName:"v-show",value:e.autoRefreshShow,expression:"autoRefreshShow"}],attrs:{type:"default"},on:{click:e.handleAutoRefreshBtnOn}},[e._v("自动刷新")]),n("Button",{directives:[{name:"show",rawName:"v-show",value:!e.autoRefreshShow,expression:"!autoRefreshShow"}],attrs:{type:"default"},on:{click:e.handleAutoRefreshBtnOff}},[e._v("关闭刷新")])],1)],1)],1),n("Row",[n("Col",{attrs:{span:"2"}},[n("Form",{attrs:{inline:""}},[n("FormItem",[n("Dropdown",{attrs:{trigger:"click"},on:{"on-click":e.handleEnvChange}},[n("Button",{attrs:{type:"primary",ghost:""}},[e._v("\n              环境切换\n              "),n("Icon",{attrs:{type:"ios-arrow-down"}})],1),n("DropdownMenu",{attrs:{slot:"list"},slot:"list"},e._l(e.envList,function(t){return n("DropdownItem",{key:t,attrs:{name:t}},[e._v(e._s(t))])}))],1)],1)],1)],1),n("Col",{attrs:{span:"2",offset:"15"}},[n("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"default",icon:"md-refresh"},on:{click:function(){e.refreshTaskList()}}},[e._v("刷新")])],1),n("Col",{attrs:{span:"5"}},[n("Input",{attrs:{placeholder:"App Name",search:""},on:{"on-keyup":function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.enterSearch(t):null}},model:{value:e.searchVal,callback:function(t){e.searchVal=t},expression:"searchVal"}})],1)],1),n("Page",{attrs:{total:e.pageTotal,"show-sizer":"","show-total":"",size:"small","page-size":e.pageSize,"page-size-opts":e.pageSizeOpts,current:e.currentPage},on:{"on-change":e.pageChange,"on-page-size-change":e.pageSizeChange}}),n("br"),n("Table",{ref:"table",attrs:{columns:e.tableColumns,loading:e.tableLoading,data:e.tableDatas},on:{"on-expand":e.handleExpand}})],1)],1)},r=[],o=(n("ac6a"),n("cadf"),n("551c"),n("097d"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Modal",{attrs:{"mask-closable":!1,title:"创建发布任务",styles:{top:"20px"}},on:{"on-cancel":e.switchTaskModal},model:{value:e.createModal,callback:function(t){e.createModal=t},expression:"createModal"}},[n("Alert",{attrs:{"show-icon":""}},[e._v('什么是发布周期? 发布周期指的是该APP 其所属的IP上都发布了同一个版本称为一个周期。 PS: "'),n("b",{staticStyle:{color:"red","font-size":"13x"}},[e._v("*")]),e._v('" 号必填')]),n("Tabs",{attrs:{type:"card"},on:{"on-click":e.handleEndpointChange}},[n("TabPane",{attrs:{label:"Backend（后端）",name:"backend"}},[n("Alert",{directives:[{name:"show",rawName:"v-show",value:e.backendReleaseWarn,expression:"backendReleaseWarn"}],attrs:{type:"warning","show-icon":""}},[e._v("现在您选择的环境为"),n("b",{staticStyle:{color:"red"}},[e._v("线上环境(Release)")]),e._v(", 请确认发布环境。")]),n("Form",{ref:"backendForm",attrs:{model:e.backendForm,rules:e.ruleBackendForm,"label-width":100}},[n("FormItem",{attrs:{label:"动作:",prop:"action"}},[n("Select",{staticStyle:{width:"300px"},on:{"on-change":function(){e.backendAction=e.backendForm.action}},model:{value:e.backendForm.action,callback:function(t){e.$set(e.backendForm,"action",t)},expression:"backendForm.action"}},e._l(e.actionList,function(t){return n("Option",{key:t[0],attrs:{value:t[0]}},[e._v(e._s(t[1])+"\n                  "),n("span",{staticStyle:{float:"right",color:"#ccc"}},[e._v(e._s(t[0]))])])}))],1),n("FormItem",{attrs:{label:"环境:",prop:"env"}},[n("Select",{staticStyle:{width:"300px"},attrs:{filterable:""},on:{"on-change":e.handleEnvChange},model:{value:e.backendForm.env,callback:function(t){e.$set(e.backendForm,"env",t)},expression:"backendForm.env"}},e._l(e.publishEnvList,function(t){return n("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}))],1),n("FormItem",{attrs:{label:"应用名:",prop:"app_name"}},[n("Select",{staticStyle:{width:"300px"},attrs:{filterable:""},on:{"on-change":e.handleAppNameChange,"on-open-change":e.handleOpenAppName},model:{value:e.backendForm.app_name,callback:function(t){e.$set(e.backendForm,"app_name","string"===typeof t?t.trim():t)},expression:"backendForm.app_name"}},e._l(e.appNameBackendList,function(t){return n("Option",{key:t[0],attrs:{value:t[0],disabled:t[1]}},[e._v(e._s(t[0])+"\n                  ")])}))],1),n("FormItem",{attrs:{label:"发布IP:",prop:"ip"}},[n("Select",{staticStyle:{width:"300px","margin-right":"10px"},on:{"on-open-change":e.handleHasBeenPublished},model:{value:e.backendForm.ip,callback:function(t){e.$set(e.backendForm,"ip",t)},expression:"backendForm.ip"}},e._l(e.publishIpList,function(t){return n("Option",{key:t[0],attrs:{value:t[0],disabled:t[1]}},[e._v(e._s(t[0])+"\n                  "),n("span",{directives:[{name:"show",rawName:"v-show",value:t[1],expression:"ip[1]"}],staticStyle:{float:"right",color:"#ccc"}},[e._v("LOCK")]),n("span",{directives:[{name:"show",rawName:"v-show",value:!t[1],expression:"!ip[1]"}],staticStyle:{float:"right",color:"#ccc"}},[e._v("UNLOCK")])])})),n("Tooltip",{attrs:{content:"被锁定的IP，是发布周期内已发布的IP;",placement:"left-start"}},[n("Button",{attrs:{type:"default",size:"small",icon:"ios-unlock",loading:e.unlockBtnLoading},on:{click:e.handleUnlockPublishIp}},[e._v("解锁")])],1)],1),n("FormItem",{directives:[{name:"show",rawName:"v-show",value:"Rollback"!==e.backendAction,expression:"backendAction !== 'Rollback'"}],attrs:{label:"分支:",prop:"branch"}},[n("Select",{staticStyle:{width:"300px"},attrs:{filterable:"",placement:"top"},model:{value:e.backendForm.branch,callback:function(t){e.$set(e.backendForm,"branch",t)},expression:"backendForm.branch"}},e._l(e.branchList,function(t){return n("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}))],1),n("FormItem",{directives:[{name:"show",rawName:"v-show",value:"Rollback"===e.backendAction,expression:"backendAction === 'Rollback'"}],attrs:{label:"历史版本:",prop:"publish_version"}},[n("Select",{staticStyle:{width:"300px","margin-right":"10px"},on:{"on-open-change":e.handleAlreadyPublishVer},model:{value:e.backendForm.publish_version,callback:function(t){e.$set(e.backendForm,"publish_version",t)},expression:"backendForm.publish_version"}},e._l(e.alreadyPublishVerList,function(t,a){return n("Option",{key:a,attrs:{value:a}},[e._v(e._s(a)+"\n                  "),n("span",{staticStyle:{float:"right",color:"#ccc"}},[e._v("分支: "+e._s(t))])])})),n("Tooltip",{attrs:{content:"只显示2个发布周期完整的版本",placement:"left-start"}},[n("Icon",{attrs:{type:"ios-alert-outline",size:"20"}})],1)],1),n("FormItem",{attrs:{label:"代码覆盖率:",prop:"is_jacoco"}},[n("Checkbox",{on:{click:function(){e.backendForm.is_sync=!e.backendForm.is_jacoco}},model:{value:e.backendForm.is_jacoco,callback:function(t){e.$set(e.backendForm,"is_jacoco",t)},expression:"backendForm.is_jacoco"}},[e._v(" 是")])],1),n("FormItem",{attrs:{label:"同步执行:",prop:"is_sync"}},[n("Checkbox",{on:{"on-change":function(){e.backendForm.sync_env="",e.backendForm.sync_ip=""}},model:{value:e.backendForm.is_sync,callback:function(t){e.$set(e.backendForm,"is_sync",t)},expression:"backendForm.is_sync"}},[e._v(" 是")])],1),n("FormItem",{directives:[{name:"show",rawName:"v-show",value:e.backendForm.is_sync,expression:"backendForm.is_sync"}],attrs:{label:"同步环境:",prop:"sync_env"}},[n("Select",{staticStyle:{width:"300px"},attrs:{filterable:"",placement:"top"},on:{"on-change":e.handleSyncEnvChange},model:{value:e.backendForm.sync_env,callback:function(t){e.$set(e.backendForm,"sync_env",t)},expression:"backendForm.sync_env"}},e._l(e.publishEnvList,function(t){return n("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}))],1),n("FormItem",{directives:[{name:"show",rawName:"v-show",value:e.backendForm.is_sync,expression:"backendForm.is_sync"}],attrs:{label:"同步环境IP:",prop:"sync_ip"}},[n("Select",{staticStyle:{width:"300px"},attrs:{placement:"top"},model:{value:e.backendForm.sync_ip,callback:function(t){e.$set(e.backendForm,"sync_ip",t)},expression:"backendForm.sync_ip"}},e._l(e.syncPublishIpList,function(t){return n("Option",{key:t[0],attrs:{value:t[0]}},[e._v(e._s(t[0])+"\n                ")])}))],1)],1)],1),n("TabPane",{attrs:{label:"Frontend (前端)",name:"frontend"}},[n("Alert",{directives:[{name:"show",rawName:"v-show",value:e.frontendReleaseWarn,expression:"frontendReleaseWarn"}],attrs:{type:"warning","show-icon":""}},[e._v("现在您选择的环境为"),n("b",{staticStyle:{color:"red"}},[e._v("线上环境(Release)")]),e._v(", 请确认发布环境。")]),n("Form",{ref:"frontendForm",attrs:{model:e.frontendForm,"label-width":110,rules:e.ruleFrontendForm}},[n("FormItem",{attrs:{label:"动作:",prop:"action"}},[n("Select",{staticStyle:{width:"300px"},on:{"on-change":function(){e.frontendAction=e.frontendForm.action}},model:{value:e.frontendForm.action,callback:function(t){e.$set(e.frontendForm,"action",t)},expression:"frontendForm.action"}},e._l(e.actionList,function(t){return n("Option",{key:t[0],attrs:{value:t[0]}},[e._v(e._s(t[1])+"\n                  "),n("span",{staticStyle:{float:"right",color:"#ccc"}},[e._v(e._s(t[0]))])])}))],1),n("FormItem",{attrs:{label:"环境:",prop:"env"}},[n("Select",{staticStyle:{width:"300px"},on:{"on-change":e.handleEnvChange},model:{value:e.frontendForm.env,callback:function(t){e.$set(e.frontendForm,"env",t)},expression:"frontendForm.env"}},e._l(e.publishEnvList,function(t){return n("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}))],1),n("FormItem",{attrs:{label:"应用名:",prop:"app_name"}},[n("Select",{staticStyle:{width:"300px"},attrs:{filterable:""},on:{"on-change":e.handleAppNameChange,"on-open-change":e.handleOpenAppName},model:{value:e.frontendForm.app_name,callback:function(t){e.$set(e.frontendForm,"app_name","string"===typeof t?t.trim():t)},expression:"frontendForm.app_name"}},e._l(e.appNameBackendList,function(t){return n("Option",{key:t[0],attrs:{value:t[0],disabled:t[1]}},[e._v(e._s(t[0])+"\n                  ")])}))],1),n("FormItem",{attrs:{label:"发布IP:",prop:"ip"}},[n("Select",{staticStyle:{width:"300px","margin-right":"10px"},on:{"on-open-change":e.handleHasBeenPublished},model:{value:e.frontendForm.ip,callback:function(t){e.$set(e.frontendForm,"ip",t)},expression:"frontendForm.ip"}},e._l(e.publishIpList,function(t){return n("Option",{key:t[0],attrs:{value:t[0],disabled:t[1]}},[e._v(e._s(t[0])+"\n                  "),n("span",{directives:[{name:"show",rawName:"v-show",value:t[1],expression:"ip[1]"}],staticStyle:{float:"right",color:"#ccc"}},[e._v("LOCK")]),n("span",{directives:[{name:"show",rawName:"v-show",value:!t[1],expression:"!ip[1]"}],staticStyle:{float:"right",color:"#ccc"}},[e._v("UNLOCK")])])})),n("Tooltip",{attrs:{content:"被锁定的IP，是发布周期内已发布的IP;",placement:"left-start"}},[n("Button",{attrs:{type:"default",size:"small",icon:"ios-unlock",loading:e.unlockBtnLoading},on:{click:e.handleUnlockPublishIp}},[e._v("解锁")])],1)],1),n("FormItem",{directives:[{name:"show",rawName:"v-show",value:"Rollback"!==e.frontendAction,expression:"frontendAction !== 'Rollback'"}],attrs:{label:"分支:",prop:"branch"}},[n("Select",{staticStyle:{width:"300px"},attrs:{filterable:"",placement:"top"},model:{value:e.frontendForm.branch,callback:function(t){e.$set(e.frontendForm,"branch",t)},expression:"frontendForm.branch"}},e._l(e.branchList,function(t){return n("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}))],1),n("FormItem",{directives:[{name:"show",rawName:"v-show",value:"Rollback"===e.frontendAction,expression:"frontendAction === 'Rollback'"}],attrs:{label:"历史版本:",prop:"publish_version"}},[n("Select",{staticStyle:{width:"300px","margin-right":"10px"},on:{"on-open-change":e.handleAlreadyPublishVer},model:{value:e.frontendForm.publish_version,callback:function(t){e.$set(e.frontendForm,"publish_version",t)},expression:"frontendForm.publish_version"}},e._l(e.alreadyPublishVerList,function(t,a){return n("Option",{key:a,attrs:{value:a}},[e._v(e._s(a)+"\n                  "),n("span",{staticStyle:{float:"right",color:"#ccc"}},[e._v("分支: "+e._s(t))])])})),n("Tooltip",{attrs:{content:"只显示2个发布周期完整的版本",placement:"left-start"}},[n("Icon",{attrs:{type:"ios-alert-outline",size:"20"}})],1)],1),n("FormItem",{attrs:{label:"同步执行:",prop:"is_sync"}},[n("Checkbox",{on:{"on-change":function(){e.frontendForm.sync_env="",e.frontendForm.sync_ip=""}},model:{value:e.frontendForm.is_sync,callback:function(t){e.$set(e.frontendForm,"is_sync",t)},expression:"frontendForm.is_sync"}},[e._v(" 是")])],1),n("FormItem",{directives:[{name:"show",rawName:"v-show",value:e.frontendForm.is_sync,expression:"frontendForm.is_sync"}],attrs:{label:"同步环境:",prop:"sync_env"}},[n("Select",{staticStyle:{width:"300px"},attrs:{placement:"top"},on:{"on-change":e.handleSyncEnvChange},model:{value:e.frontendForm.sync_env,callback:function(t){e.$set(e.frontendForm,"sync_env",t)},expression:"frontendForm.sync_env"}},e._l(e.publishEnvList,function(t){return n("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}))],1),n("FormItem",{directives:[{name:"show",rawName:"v-show",value:e.frontendForm.is_sync,expression:"frontendForm.is_sync"}],attrs:{label:"同步环境IP:",prop:"sync_ip"}},[n("Select",{staticStyle:{width:"300px"},attrs:{placement:"top"},model:{value:e.frontendForm.sync_ip,callback:function(t){e.$set(e.frontendForm,"sync_ip",t)},expression:"frontendForm.sync_ip"}},e._l(e.syncPublishIpList,function(t){return n("Option",{key:t[0],attrs:{value:t[0]}},[e._v(e._s(t[0])+"\n              ")])}))],1)],1)],1)],1),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"default"},on:{click:function(t){e.handleReset(e.currentForm)}}},[e._v("重置")]),n("Button",{attrs:{type:"primary",ghost:"",loading:e.CommitBtnLoading},on:{click:e.handleTask}},[e._v("发布")])],1)],1)],1)}),s=[],i=(n("7f7f"),n("66df")),c=n("6821f"),l={pp:c("code_publish_issue")},h=function(){return i["a"].request({url:"/api/v1/code-publish/web/control/main/",method:"get",headers:l})},u=function(){return i["a"].request({url:"/api/v1/code-publish/web/env/",method:"get",headers:l})},p=function(e,t){return i["a"].request({url:"/api/v1/code-publish/web/control/main-conf/?app_name=".concat(e,"&env=").concat(t),method:"get",headers:l})},d=function(e,t,n){return i["a"].request({url:"/api/v1/code-publish/web/has-been-published/?app_name=".concat(e,"&env=").concat(t,"&action=").concat(n),method:"get",headers:l})},m=function(e,t){return i["a"].request({url:"/api/v1/code-publish/web/get-branch/?app_name=".concat(e,"&env=").concat(t),method:"get",headers:l})},f=function(e){return i["a"].request({url:"/api/v1/code-publish/web/control/main/",method:"post",headers:l,data:e})},b=function(e){return i["a"].request({url:"/api/v1/code-publish/web/control/main/".concat(e,"/"),method:"delete",headers:l})},v=function(){return i["a"].request({url:"/api/v1/code-publish/web/control/task-status/",method:"get",headers:l})},k=function(e){return i["a"].request({url:"/api/v1/code-publish/web/real-time/steps/".concat(e,"/"),method:"get",headers:l})},_=function(e){return i["a"].request({url:"/api/v1/code-publish/web/stop-building/".concat(e,"/"),method:"delete",headers:l})},g=function(){return i["a"].request({url:"/api/v1/code-publish/web/real-time/task-status/",method:"get",headers:l})},F=function(e,t){return i["a"].request({url:"/api/v1/code-publish/web/already-version/?app_name=".concat(e,"&env=").concat(t),method:"get",headers:l})},y=function(e,t){return i["a"].request({url:"/api/v1/code-publish/web/app-name/endpoint/?web_tag=".concat(e,"&env=").concat(t),method:"get",headers:l})},w=function(e){return i["a"].request({url:"/api/v1/code-publish/web/unlock/publish-ip/",method:"post",headers:l,data:e})},L=function(){return i["a"].request({url:"/api/v1/code-publish/web/lock-env/",method:"get",headers:l})},S=function(){return i["a"].request({url:"/api/v1/users/open/",method:"get",headers:l})},x=function(e){return i["a"].request({url:"/api/v1/code-publish/web/lock-env-app/?env=".concat(e),method:"get",headers:l})},T=function(e){return i["a"].request({url:"/api/v1/code-publish/web/lock-env-app/".concat(e,"/"),method:"get",headers:l})},O=function(e){return i["a"].request({url:"/api/v1/code-publish/web/lock-env/",method:"post",headers:l,data:e})},I=function(e,t){return i["a"].request({url:"/api/v1/code-publish/web/lock-env/".concat(e,"/"),method:"put",headers:l,data:t})},C=function(e){return i["a"].request({url:"/api/v1/code-publish/web/unlock-env/".concat(e,"/"),method:"delete",headers:l})},B=n("c276"),A={name:"publish_task",computed:{createModal:{get:function(){return this.taskModal},set:function(e){this.$emit("switchTaskModal",e)}}},watch:{backendAction:function(e,t){console.log(e),"Rollback"===e?(delete this.ruleBackendForm["branch"],this.ruleBackendForm["publish_version"]=[{required:!0,message:"必须填写",trigger:"change"}]):"Deploy"===e&&(delete this.ruleBackendForm["publish_version"],this.ruleBackendForm["branch"]=[{required:!0,message:"必须填写",trigger:"change"}])},frontendAction:function(e,t){console.log(e),"Rollback"===e?(delete this.ruleFrontendForm["branch"],this.ruleFrontendForm["publish_version"]=[{required:!0,message:"必须填写",trigger:"change"}]):"Deploy"===e&&(delete this.ruleFrontendForm["publish_version"],this.ruleFrontendForm["branch"]=[{required:!0,message:"必须填写",trigger:"change"}])}},props:["taskModal"],data:function(){return{frontendReleaseWarn:!1,backendReleaseWarn:!1,unlockBtnLoading:!1,CommitBtnLoading:!1,commitForm:{},backendForm:{action:"",app_name:"",env:"",ip:"",branch:"",is_sync:!1,sync_env:"",sync_ip:"",is_jacoco:!1,publish_version:""},ruleBackendForm:{action:[{required:!0,message:"必须填写",trigger:"change"}],app_name:[{required:!0,message:"必须填写",trigger:"change"}],env:[{required:!0,message:"必须填写",trigger:"change"}],ip:[{required:!0,message:"必须填写",trigger:"change"}],branch:[{required:!0,message:"必须填写",trigger:"change"}],publish_version:[{required:!1,message:"必须填写",trigger:"change"}]},frontendForm:{action:"",app_name:"",env:"",ip:"",branch:"",is_sync:!1,sync_env:"",sync_ip:"",publish_version:"",git_diff_before:!1,git_diff_after:!1},ruleFrontendForm:{action:[{required:!0,message:"必须填写",trigger:"change"}],app_name:[{required:!0,message:"必须填写",trigger:"change"}],env:[{required:!0,message:"必须填写",trigger:"change"}],ip:[{required:!0,message:"必须填写",trigger:"change"}],branch:[{required:!0,message:"必须填写",trigger:"change"}]},actionList:[["Deploy","发布"],["Rollback","回滚"]],backendServerMode:["docker","jar","tomcat","tc2docker"],frontendServerMode:["php","pc","mobile"],appDetailList:[],publishEnvList:[],publishIpList:[],branchList:[],alreadyPublishVerList:[],currentForm:"backendForm",syncPublishIpList:[],frontendAction:"Deploy",backendAction:"Deploy",backendAppNameList:[],appNameBackendList:[],appNameFrontendList:[]}},methods:{handleOpenAppName:function(){var e,t,n=this;"backendForm"===this.currentForm?(e="backend",t=this.backendForm.env,y(e,t).then(function(e){n.appNameBackendList=e.data}).catch(function(e){Object(B["s"])("error",e)})):(e="frontend",t=this.frontendForm.env,y(e,t).then(function(e){n.appNameBackendList=e.data}).catch(function(e){Object(B["s"])("error",e)}))},handleUnlockPublishIp:function(){var e,t,n,a=this;"backendForm"===this.currentForm?(e=this.backendForm.app_name,t=this.backendForm.env,n=this.backendAction):(e=this.frontendForm.app_name,t=this.frontendForm.env,n=this.frontendAction);var r={app_name:e,env:t,action:n};this.unlockBtnLoading=!0,w(r).then(function(e){a.handleHasBeenPublished(),a.$Message.success("成功解锁"),a.unlockBtnLoading=!1}).catch(function(e){Object(B["s"])("error","解锁失败"),Object(B["s"])("error",e),a.unlockBtnLoading=!1})},handleBackendAppNameChange:function(){var e=this;this.backendForm.env="",this.backendForm.publish_version="",this.backendForm.ip="",this.backendForm.branch="",getAppMainConfig("backend").then(function(t){e.backendAppNameList=t.data}).catch(function(e){Object(B["s"])("error",e)})},handleAlreadyPublishVer:function(){var e,t,n=this;"backendForm"===this.currentForm?(e=this.backendForm.app_name,t=this.backendForm.env):(e=this.frontendForm.app_name,t=this.frontendForm.env),F(e,t).then(function(e){n.alreadyPublishVerList=e.data}).catch(function(e){Object(B["s"])("error",e)})},handleHasBeenPublished:function(){var e,t,n,a=this;"backendForm"===this.currentForm?(e=this.backendForm.app_name,t=this.backendForm.env,n=this.backendForm.action):(e=this.frontendForm.app_name,t=this.frontendForm.env,n=this.frontendForm.action),d(e,t,n).then(function(e){a.publishIpList=a.publishIpList.filter(function(t){return-1===e.data.indexOf(t[0])?(t.length>1&&t.pop(),t.push(!1)):(t.length>1&&t.pop(),t.push(!0))})}).catch(function(e){Object(B["s"])("error",e)})},handleEnvChange:function(){"backendForm"===this.currentForm?(this.backendForm.ip="",this.backendForm.app_name="",this.backendForm.publish_ip="",this.backendForm.branch="",this.publishIpList=[],this.branchList=[],this.backendReleaseWarn="Release"===this.backendForm.env):(this.frontendForm.ip="",this.frontendForm.app_name="",this.frontendForm.publish_ip="",this.frontendForm.branch="",this.publishIpList=[],this.branchList=[],this.frontendReleaseWarn="Release"===this.frontendForm.env)},handleAppNameChange:function(e){var t,n,a=this;"backendForm"===this.currentForm?(t=this.backendForm.app_name,n=this.backendForm.env,this.backendForm.ip=""):(t=this.frontendForm.app_name,n=this.frontendForm.env,this.frontendForm.ip=""),t&&e&&(p(t,n).then(function(e){console.log(e.data),a.publishIpList=e.data}).catch(function(e){Object(B["s"])("error",e)}),m(t,n).then(function(e){a.branchList=e.data}).catch(function(e){a.branchList=[],Object(B["s"])("error",e)}))},handleSyncEnvChange:function(e){var t=this;this.backendForm.sync_ip="",this.frontendForm.sync_ip="","backendForm"===this.currentForm?this.backendForm.app_name&&p(this.backendForm.app_name,e).then(function(e){t.syncPublishIpList=e.data}).catch(function(e){Object(B["s"])("error",e)}):this.frontendForm.app_name&&p(this.frontendForm.app_name,e).then(function(e){t.syncPublishIpList=e.data}).catch(function(e){Object(B["s"])("error",e)})},commitTask:function(){this.CommitBtnLoading=!1,this.switchTaskModal(!1)},handleTask:function(){console.log(this.currentForm),"backendForm"===this.currentForm?(this.CommitBtnLoading=!0,this.handleBackendTask(this.currentForm)):"frontendForm"===this.currentForm&&(this.CommitBtnLoading=!0,this.handleFrontendTask(this.currentForm))},handleBackendTask:function(e){var t=this,n={IsJacoco:this.backendForm.is_jacoco},a={action:this.backendForm["action"],app_name:this.backendForm["app_name"],env:this.backendForm["env"],publish_ip:this.backendForm["ip"],branch:this.backendForm["branch"],is_sync:this.backendForm["is_sync"]?1:0,sync_env:this.backendForm["sync_env"],sync_ip:this.backendForm["sync_ip"],jenkins_params:JSON.stringify(n),publish_version:this.backendForm["publish_version"]};this.$refs[e].validate(function(e){e?f(a).then(function(e){t.$Message.success("创建发布任务成功"),t.commitTask(),t.backendForm.ip="",t.$emit("refreshTaskList")}).catch(function(e){Object(B["s"])("error",e),t.commitTask()}):(t.$Message.error("缺少必填参数"),t.CommitBtnLoading=!1)})},handleFrontendTask:function(e){var t=this,n={},a={action:this.frontendForm["action"],app_name:this.frontendForm["app_name"],env:this.frontendForm["env"],publish_ip:this.frontendForm["ip"],branch:this.frontendForm["branch"],is_sync:this.frontendForm["is_sync"]?1:0,sync_env:this.frontendForm["sync_env"],sync_ip:this.frontendForm["sync_ip"],jenkins_params:JSON.stringify(n),publish_version:this.frontendForm["publish_version"]};console.log(a),this.$refs[e].validate(function(e){e?(f(a).then(function(e){t.$Message.success("创建发布任务成功"),t.frontendForm.ip="",t.commitTask(),t.$emit("refreshTaskList")}).catch(function(e){Object(B["s"])("error",e),t.commitTask()}),setTimeout(function(){t.commitTask()},3e3)):(t.$Message.error("缺少必填参数"),t.CommitBtnLoading=!1)})},switchTaskModal:function(e){this.$emit("switchTaskModal",e)},handleReset:function(e){this.$refs[e].resetFields()},handleEndpointChange:function(e){"backend"===e?(this.commitForm=this.backendForm,this.currentForm="backendForm"):(this.commitForm=this.frontendForm,this.currentForm="frontendForm")}},mounted:function(){var e=this;u().then(function(t){e.publishEnvList=[],t.data.forEach(function(t){"ALL"!==t.env&&e.publishEnvList.push(t.env)})}).catch(function(e){Object(B["s"])("error",e)})}},R=A,j=n("2877"),D=Object(j["a"])(R,o,s,!1,null,null,null);D.options.__file="task.vue";var M=D.exports,E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Row",{staticClass:"expand-row"},[n("Col",{attrs:{span:"24"}},[n("b",{staticClass:"expand-key"},[e._v("创建时间: ")]),n("span",[e._v("  "+e._s(e.row.created))]),n("br"),n("br"),n("b",{staticClass:"expand-key"},[e._v("进度条: ")]),n("Tooltip",{attrs:{content:"刷新时长：3min，频率：20s",placement:"right"}},[n("Button",{directives:[{name:"show",rawName:"v-show",value:e.ttButon,expression:"ttButon"}],staticStyle:{"margin-left":"10px"},attrs:{type:"default",size:"small"},on:{click:e.handleRTRefresh}},[e._v("实时刷新")]),n("Button",{directives:[{name:"show",rawName:"v-show",value:!e.ttButon,expression:"!ttButon"}],staticStyle:{"margin-left":"10px"},attrs:{type:"default",size:"small"},on:{click:e.stopRTRefresh}},[e._v("关闭刷新")])],1),n("br"),n("br"),n("Card",[e.stepsSpin?n("Spin",{attrs:{size:"large",fix:""}}):e._e(),n("Steps",{attrs:{current:e.stepsSize,size:"small",status:e.stepsStatus}},e._l(e.standerSteps,function(e){return n("Step",{key:e,attrs:{title:e}})}))],1),n("br"),n("b",{staticClass:"expand-key"},[e._v("日志信息: ")]),n("a",{attrs:{href:e.row.console_url,target:"_blank"}},[e._v("  "),n("Icon",{staticStyle:{"font-size":"18px"},attrs:{type:"ios-log-out"}}),e._v("\n        "+e._s(e.row.console_url)+"\n      ")],1),n("br"),n("br"),n("b",{staticClass:"expand-key"},[e._v("Ops版本号: ")]),n("span",[e._v("  "+e._s(e.row.publish_version))]),n("br"),n("br"),n("b",{staticClass:"expand-key"},[e._v("分支: ")]),n("span",[e._v("  "+e._s(e.row.branch))]),n("br"),n("br"),n("b",{staticClass:"expand-key"},[e._v("Git Log: ")]),n("span",[e._v("  "+e._s(e.row.git_log))]),n("br"),n("br"),n("b",{staticClass:"expand-key"},[e._v("Jenkins Job / Build Num: ")]),n("span",[e._v("  "+e._s(e.row.jenkins_job)+" / "+e._s(e.row.build_num))]),n("br"),n("br"),n("b",{staticClass:"expand-key"},[e._v("Jenkins Params: ")]),n("span",[e._v("  "+e._s(e.row.jenkins_params))]),n("br"),n("br"),n("b",{staticClass:"expand-key"},[e._v("是否同步: ")]),1==e.row.is_sync?n("span",[e._v("  是")]):e._e(),0==e.row.is_sync?n("span",[e._v("  否")]):e._e(),n("br"),n("br"),n("b",{staticClass:"expand-key"},[e._v("同步环境: ")]),n("span",[e._v("  "+e._s(e.row.sync_env))]),n("b",{staticClass:"expand-key",staticStyle:{"margin-left":"20px"}},[e._v("同步IP: ")]),n("span",[e._v("  "+e._s(e.row.sync_ip))])],1)],1)],1)},$=[],N={name:"publish_expand",props:{row:Object},data:function(){return{stepsSpin:!1,stepsSize:this.row.steps_size,stepsStatus:this.row.steps_status,standerSteps:JSON.parse(this.row.stander_steps),tt:Object,ttButon:!0}},methods:{stopRTRefresh:function(){clearInterval(this.tt),this.ttButon=!0},handleRealTimeSteps:function(){var e=this;k(this.row.id).then(function(t){e.stepsSize=t.data["steps_size"],e.stepsStatus=t.data["status"],e.stepsSpin=!1}).catch(function(t){Object(B["s"])("error",t),e.stepsSpin=!1})},handleRTRefresh:function(){var e=this;this.ttButon=!1,console.log(this.row),this.stepsSpin=!0,this.handleRealTimeSteps(),this.tt=setInterval(function(){e.stepsSpin=!0,e.handleRealTimeSteps()},2e4),setTimeout(function(){clearInterval(e.tt),e.ttButon=!0},18e4)}}},P=N,q=(n("f34b"),Object(j["a"])(P,E,$,!1,null,null,null));q.options.__file="publish_expand.vue";var z=q.exports,V=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Drawer",{attrs:{placement:"right",closable:!1,width:"450"},model:{value:e.drawerShow,callback:function(t){e.drawerShow=t},expression:"drawerShow"}},[n("p",{staticStyle:{color:"#909399",height:"32px"},attrs:{slot:"header"},slot:"header"},[n("span",[e._v("已锁定环境列表")]),n("Button",{staticStyle:{height:"30px",float:"right"},attrs:{type:"error",ghost:"",icon:"ios-lock-outline"},on:{click:e.handleCreateLockBtn}},[e._v("建锁")]),n("Button",{staticStyle:{float:"right","margin-right":"10px",height:"30px"},attrs:{type:"default",shape:"circle"},on:{click:function(){e.refreshAll()}}},[n("Icon",{attrs:{type:"md-refresh"}})],1)],1),e._l(e.publishLockData,function(t){return n("Card",{key:t.id,staticStyle:{"margin-bottom":"10px"}},[n("p",{staticStyle:{height:"24px"},attrs:{slot:"title"},slot:"title"},[n("span",{staticStyle:{display:"inline-block",overflow:"hidden",width:"60%","text-overflow":"ellipsis"},attrs:{title:t.env}},[n("Tag",{attrs:{color:"success"}},[e._v(" "+e._s(t.env))])],1),n("span",{staticStyle:{display:"inline-block",float:"right"}},[n("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",ghost:"",size:"small",icon:"ios-open-outline"},on:{click:function(n){e.handleUpdateLockBtn(t)}}},[e._v("编辑")]),n("Button",{attrs:{type:"default",size:"small",icon:"ios-unlock-outline"},on:{click:function(n){e.handleUnlockEnv(t)}}},[e._v("释放")])],1)]),n("div",{staticStyle:{height:"170px",overflow:"auto"}},[n("Form",{attrs:{"label-width":70}},[n("FormItem",{staticClass:"shadow-ivu-form-item",attrs:{label:"组名:"}},[n("b",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(t.lock_grp_name))]),e._v("\n            属主:"),n("Tag",{staticStyle:{"margin-left":"10px"},attrs:{color:"blue"}},[e._v(e._s(t.creator_info.real_name))])],1),n("FormItem",{staticClass:"shadow-ivu-form-item",attrs:{label:"成员:"}},e._l(t.user_ids,function(t){return n("Tag",{key:t.id,attrs:{type:"border"}},[e._v(e._s(t.real_name))])})),n("FormItem",{staticClass:"shadow-ivu-form-item",attrs:{label:"锁定周期:"}},[n("b",[e._v(e._s(t.lock_time)+" min")])]),n("FormItem",{staticClass:"shadow-ivu-form-item",attrs:{label:"绑定应用:"}},e._l(t.app_ids,function(t){return n("Tag",{key:t.id,attrs:{color:"default"}},[e._v(e._s(t.app_name))])})),n("FormItem",{staticClass:"shadow-ivu-form-item",attrs:{label:"创建时间:"}},[n("b",[e._v(e._s(t.created))])]),n("FormItem",{staticClass:"shadow-ivu-form-item",attrs:{label:"过期时间:"}},[n("b",[e._v(e._s(t.expired))])])],1)],1)])})],2),n("Modal",{attrs:{title:e.envLockModalTitle,"mask-closable":!1,okText:"提交",width:"700"},on:{"on-ok":e.handleEnvLock},model:{value:e.envLockModal,callback:function(t){e.envLockModal=t},expression:"envLockModal"}},[n("Form",{ref:"envLockForm",attrs:{model:e.envLockForm,"label-width":110,rules:e.ruleEnvLockForm}},[n("FormItem",{attrs:{label:"自定义名:",prop:"lock_grp_name"}},[n("Input",{staticStyle:{width:"70%"},attrs:{placeholder:"组名，长度128字符"},model:{value:e.envLockForm.lock_grp_name,callback:function(t){e.$set(e.envLockForm,"lock_grp_name","string"===typeof t?t.trim():t)},expression:"envLockForm.lock_grp_name"}})],1),n("FormItem",{attrs:{label:"锁定时间(分钟):",prop:"lock_time"}},[n("InputNumber",{staticStyle:{width:"70%"},attrs:{max:1440,placeholder:"max = 1400(min) = 1(day)"},model:{value:e.envLockForm.lock_time,callback:function(t){e.$set(e.envLockForm,"lock_time",t)},expression:"envLockForm.lock_time"}})],1),n("FormItem",{attrs:{label:"成员:",prop:"user_ids"}},[n("Select",{staticStyle:{width:"70%"},attrs:{multiple:"",filterable:""},model:{value:e.envLockForm.user_ids,callback:function(t){e.$set(e.envLockForm,"user_ids",t)},expression:"envLockForm.user_ids"}},e._l(e.usernameList,function(t){return n("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.real_name))])}))],1),n("FormItem",{attrs:{label:"环境:",prop:"env"}},[n("Tag",{directives:[{name:"show",rawName:"v-show",value:!e.lockEnvShow,expression:"!lockEnvShow"}],attrs:{color:"volcano"}},[e._v(" "+e._s(e.envLockForm.env))]),n("Select",{directives:[{name:"show",rawName:"v-show",value:e.lockEnvShow,expression:"lockEnvShow"}],staticStyle:{width:"70%"},attrs:{filterable:""},on:{"on-change":e.handleEnvChange},model:{value:e.envLockForm.env,callback:function(t){e.$set(e.envLockForm,"env",t)},expression:"envLockForm.env"}},e._l(e.envList,function(t){return n("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}))],1),n("FormItem",{attrs:{label:"应用:",prop:"app_ids"}},[n("Transfer",{staticStyle:{width:"90%"},attrs:{data:e.srcAppDatas,"target-keys":e.envLockForm.app_ids,filterable:"","filter-method":e.filterMethod,titles:["可绑定的应用","已绑定的应用"]},on:{"on-change":e.handleTransferChange}})],1)],1)],1)],1)},U=[],W={name:"env_lock",props:["pdrawerShow"],computed:{drawerShow:{get:function(){return this.pdrawerShow},set:function(e){this.$emit("switchdrawerShow",e)}}},watch:{drawerShow:function(e,t){e&&this.refreshAll()}},data:function(){return{userID:Object(B["k"])(),lockEnvShow:!0,srcAppDatas:[],usernameList:[],envLockModal:!1,envLockModalTitle:"",currentAction:"create",envLockForm:{lock_grp_name:"",lock_time:60,user_ids:[],env:"",app_ids:[],creator:0,delay_lock_time:0},envList:[],ruleEnvLockForm:{lock_grp_name:[{required:!0,message:"必须填写，长度128字符",trigger:"blur"}],lock_time:[{required:!0,message:"必须填写，最大值1400",trigger:"blur",type:"number"}],user_ids:[{required:!0,message:"必须填写",trigger:"blur",type:"array"}],env:[{required:!0,message:"必须填写",trigger:"blur",type:"string"}],app_ids:[{required:!0,message:"必须填写",trigger:"blur",type:"array"}]},publishLockData:[],choseUpdateEnvLockItem:{}}},methods:{handleUnlockEnv:function(e){var t=this;C(e.id).then(function(e){t.$Message.success("成功释放"),t.refreshAll()}).catch(function(e){Object(B["s"])("error",e)})},handleEnvChange:function(e){var t=this;x(e).then(function(e){t.srcAppDatas=e.data,t.envLockForm.app_ids=[]}).catch(function(e){Object(B["s"])("error",e)})},handleCreateLockBtn:function(){this.currentAction="create",this.envLockModal=!0,this.envLockModalTitle="创建环境锁",this.lockEnvShow=!0,this.envLockForm={lock_grp_name:"",lock_time:60,user_ids:[],env:"",app_ids:[],creator:this.userID}},handleUpdateLockBtn:function(e){var t=this;this.userID===e.creator?(this.currentAction="update",this.envLockModal=!0,this.envLockModalTitle="更新环境锁",this.lockEnvShow=!1,this.envLockForm.id=e.id,this.envLockForm.env=e.env,this.envLockForm.lock_grp_name=e.lock_grp_name,this.envLockForm.lock_time=e.lock_time,this.envLockForm.creator=e.creator,this.envLockForm.user_ids=[],e.user_ids.forEach(function(e){t.envLockForm.user_ids.push(e.id)}),x(e.env).then(function(e){t.srcAppDatas=e.data}).catch(function(e){Object(B["s"])("error",e)}),T(e.id).then(function(e){t.envLockForm.app_ids=e.data}).catch(function(e){Object(B["s"])("error",e)})):this.$Modal.warning({title:"权限警告",content:"您不是该环境锁的Creator，请联系Creator"})},handleEnvLock:function(){var e=this;"create"===this.currentAction?O(this.envLockForm).then(function(t){e.$Message.success("成功锁定"),e.refreshAll()}).catch(function(e){e.response.data["non_field_errors"][0].indexOf("唯一")>=-1&&Object(B["s"])("error","您已创建该环境的锁，无需重复建锁."),Object(B["s"])("error",e)}):"update"===this.currentAction&&I(this.envLockForm.id,this.envLockForm).then(function(t){e.$Message.success("更新锁成功"),e.refreshAll()}).catch(function(e){Object(B["s"])("error",e)})},handleTransferChange:function(e){console.log(e),this.envLockForm.app_ids=e},filterMethod:function(e,t){return e.label.indexOf(t)>-1},refreshEnvLockList:function(){var e=this;L().then(function(t){e.publishLockData=t.data}).catch(function(e){Object(B["s"])("error",e)})},refreshAll:function(){var e=this;this.refreshEnvLockList(),u().then(function(t){e.envList=[],t.data.forEach(function(t){"ALL"!==t.env&&e.envList.push(t.env)})}).catch(function(e){Object(B["s"])("error",e)}),S().then(function(t){e.usernameList=t.data}).catch(function(e){Object(B["s"])("error",e)})}},mounted:function(){this.refreshAll()}},J=W,H=(n("6537"),Object(j["a"])(J,V,U,!1,null,"6df5fdc2",null));H.options.__file="env_lock.vue";var K=H.exports,G={name:"code_publish_publish",components:{Task:M,expandRow:z,EnvLock:K},data:function(){var e=this;return{envLockModalShow:!1,drawerShow:!1,taskModal:!1,rollbackModal:!1,searchVal:"",envList:["ALL"],tableLoading:!1,tableColumns:[{type:"expand",width:30,render:function(e,t){return e(z,{props:{row:t.row}})}},{title:"动作",sortable:!0,key:"action",width:110,render:function(e,t){var n,a;switch(t.row.action){case"Deploy":n="发布",a="green";break;case"Rollback":n="回滚",a="red";break;case"DeploySync":n="同步发布",a="cyan";break;default:n="未知",a="#909399";break}return e("div",{},[e("Tag",{props:{color:a}},n)])}},{title:"应用名",key:"app_name",width:120},{title:"环境",key:"env",width:100,sortable:!0,tooltip:!0},{title:"发布IP",key:"publish_ip",width:120,tooltip:!0},{title:"ops版本 / 分支",render:function(e,t){return e("div",{},[e("p",{},"版本: ".concat(t.row.publish_version)),e("p",{},"分支: ".concat(t.row.branch))])}},{title:"发布者",key:"creator",width:130,tooltip:!0,render:function(e,t){return e("div",{},[e("Tag",{props:{type:"border"}},t.row.creator)])}},{title:"更新时间",key:"updated",align:"center",width:105,sortable:!0},{title:"状态",align:"center",width:80,render:function(e,t){var n,a,r="#F56C6C",o="#909399",s="#67C23A",i="#409EFF";switch(t.row.status){case 1:n=s,a="发布成功";break;case 2:n=r,a="发布失败";break;case 3:n=i,a="执行中";break;case 4:n=r,a="被终止";break;default:n=o,a="未知/等待";break}return e("Tooltip",{props:{content:"".concat(a),placement:"left"}},[e("Icon",{props:{type:"ios-radio-button-on"},style:{"font-size":"20px",color:"".concat(n)}})])}},{title:"操作",align:"center",width:120,render:function(t,n){return t("div",{},[t("Tooltip",{props:{content:"终止发布",placement:"left"}},[t("Icon",{props:{type:"md-close"},style:{"font-size":"20px",color:"#F56C6C",cursor:"pointer"},on:{click:function(){e.tableLoading=!0,e.$Message.info("发送 stop build 动作"),_(n.row.id).then(function(t){e.$Message.success("停止build任务成功"),e.tableLoading=!1}).catch(function(t){Object(B["s"])("error",t),e.tableLoading=!1})}}})]),t("Tooltip",{props:{content:"删除该记录",placement:"left"}},[t("Icon",{props:{type:"md-trash"},style:{"margin-left":"20px","font-size":"20px",color:"#909399",cursor:"pointer"},on:{click:function(){b(n.row.id).then(function(t){e.$Message.success("删除成功"),e.refreshTaskList()}).catch(function(e){Object(B["s"])("error",e)})}}})])])}}],tableDatas:[],tableOriginDatas:[],tmpTableOriginDatas:[],statusColumns:[{title:"App Name",key:"app_name",width:120},{title:"Env",key:"env",width:80},{title:"发布IP",key:"publish_ip",width:120},{title:"Branch",key:"branch",tooltip:!0},{title:"状态",align:"center",width:80,render:function(e,t){var n,a,r="#F56C6C",o="#909399",s="#67C23A",i="#409EFF";switch(t.row.status){case 1:n=s,a="发布成功";break;case 2:n=r,a="发布失败";break;case 3:n=i,a="执行中";break;default:n=o,a="未知/等待";break}return e("Tooltip",{props:{content:"".concat(a),placement:"left"}},[e("Icon",{props:{type:"ios-radio-button-on"},style:{"font-size":"20px",color:"".concat(n)}})])}}],statusTableLoading:!1,statusDatas:[],pageTotal:0,pageSize:10,pageSizeOpts:[10,20,50,100],currentPage:1,autoTaskRefreshTimer:Object,taskStatusTimer:Object,autoRefreshShow:!0}},methods:{switchdrawerShow:function(e){this.drawerShow=e},handleAutoRefreshBtnOn:function(){var e=this;this.autoRefreshShow=!1,this.refreshTaskList(),this.autoTaskRefreshTimer=setInterval(function(){e.refreshTaskList()},3e4)},handleAutoRefreshBtnOff:function(){clearInterval(this.autoTaskRefreshTimer),this.autoRefreshShow=!0},enterSearch:function(){var e=this;if(this.tableLoading=!0,!this.searchVal)return this.tableDatas=this.tableOriginDatas,void(this.tableLoading=!1);this.tableDatas=this.tableOriginDatas.filter(function(t){if(-1!==t.app_name.indexOf(e.searchVal))return t}),this.tableLoading=!1},pageSizeChange:function(e){this.pageSize=e,this.spliceTableDatas(1,this.tableOriginDatas)},pageChange:function(e){this.spliceTableDatas(e,this.tmpTableOriginDatas)},spliceTableDatas:function(e,t){this.tableDatas=t.slice(e*this.pageSize-this.pageSize,e*this.pageSize)},handleTaskStatus:function(){var e=this;g().then(function(t){e.statusDatas=t.data.reverse(),e.statusTableLoading=!1}).catch(function(t){Object(B["s"])("error",t),e.statusTableLoading=!1})},taskStatusShow:function(){var e=this;this.statusTableLoading=!0,this.handleTaskStatus(),this.taskStatusTimer=setInterval(function(){e.statusTableLoading=!0,e.handleTaskStatus()},15e3)},taskStatusHide:function(){clearInterval(this.taskStatusTimer)},handleExpand:function(e,t){console.log(t),console.log(e)},switchTaskModal:function(e){this.taskModal=e},refreshTaskList:function(){var e=this;this.tableLoading=!0,this.currentPage=1,h().then(function(t){e.tableOriginDatas=t.data,e.tableDatas=t.data,e.tmpTableOriginDatas=t.data,e.pageTotal=t.data.length,e.pageChange(1),e.tableLoading=!1}).catch(function(t){e.tableLoading=!1,Object(B["s"])("error",t)})},handleEnvChange:function(e){var t=this;this.tableLoading=!0,this.tmpTableOriginDatas=[],"ALL"!==e?(this.tableOriginDatas.forEach(function(n){n.env===e&&t.tmpTableOriginDatas.push(n)}),this.pageTotal=this.tmpTableOriginDatas.length,this.spliceTableDatas(1,this.tmpTableOriginDatas)):"ALL"===e&&(this.tmpTableOriginDatas=this.tableOriginDatas,this.pageTotal=this.tableOriginDatas.length,this.spliceTableDatas(1,this.tableOriginDatas)),this.tableLoading=!1}},mounted:function(){var e=this;this.handleTaskStatus(),this.refreshTaskList(),u().then(function(t){e.envList=[],t.data.forEach(function(t){e.envList.push(t.env)})}).catch(function(e){Object(B["s"])("error",e)}),this.taskStatusTimer=setInterval(function(){v().then(function(e){}).catch(function(e){Object(B["s"])("error","定时刷新发布状态失败"),Object(B["s"])("error",e)})},2e4)},beforeDestroy:function(){clearInterval(this.taskStatusTimer),clearInterval(this.autoTaskRefreshTimer)}},Z=G,Q=(n("a288"),Object(j["a"])(Z,a,r,!1,null,"420f055c",null));Q.options.__file="publish.vue";t["default"]=Q.exports},d405:function(e,t,n){},f34b:function(e,t,n){"use strict";var a=n("5f6d"),r=n.n(a);r.a}}]);