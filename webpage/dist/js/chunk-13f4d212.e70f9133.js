(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-13f4d212"],{"00d87":function(t,e){(function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&a.rotl(t,8)|4278255360&a.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=a.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],a=0,n=0;a<t.length;a++,n+=8)e[n>>>5]|=t[a]<<24-n%32;return e},wordsToBytes:function(t){for(var e=[],a=0;a<32*t.length;a+=8)e.push(t[a>>>5]>>>24-a%32&255);return e},bytesToHex:function(t){for(var e=[],a=0;a<t.length;a++)e.push((t[a]>>>4).toString(16)),e.push((15&t[a]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],a=0;a<t.length;a+=2)e.push(parseInt(t.substr(a,2),16));return e},bytesToBase64:function(t){for(var a=[],n=0;n<t.length;n+=3)for(var i=t[n]<<16|t[n+1]<<8|t[n+2],r=0;r<4;r++)8*n+6*r<=8*t.length?a.push(e.charAt(i>>>6*(3-r)&63)):a.push("=");return a.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var a=[],n=0,i=0;n<t.length;i=++n%4)0!=i&&a.push((e.indexOf(t.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<2*i|e.indexOf(t.charAt(n))>>>6-2*i);return a}};t.exports=a})()},"6821f":function(t,e,a){(function(){var e=a("00d87"),n=a("9a63").utf8,i=a("044b"),r=a("9a63").bin,o=function(t,a){t.constructor==String?t=a&&"binary"===a.encoding?r.stringToBytes(t):n.stringToBytes(t):i(t)?t=Array.prototype.slice.call(t,0):Array.isArray(t)||(t=t.toString());for(var s=e.bytesToWords(t),c=8*t.length,l=1732584193,u=-271733879,p=-1732584194,h=271733878,f=0;f<s.length;f++)s[f]=16711935&(s[f]<<8|s[f]>>>24)|4278255360&(s[f]<<24|s[f]>>>8);s[c>>>5]|=128<<c%32,s[14+(c+64>>>9<<4)]=c;var v=o._ff,d=o._gg,g=o._hh,_=o._ii;for(f=0;f<s.length;f+=16){var m=l,b=u,y=p,k=h;l=v(l,u,p,h,s[f+0],7,-680876936),h=v(h,l,u,p,s[f+1],12,-389564586),p=v(p,h,l,u,s[f+2],17,606105819),u=v(u,p,h,l,s[f+3],22,-1044525330),l=v(l,u,p,h,s[f+4],7,-176418897),h=v(h,l,u,p,s[f+5],12,1200080426),p=v(p,h,l,u,s[f+6],17,-1473231341),u=v(u,p,h,l,s[f+7],22,-45705983),l=v(l,u,p,h,s[f+8],7,1770035416),h=v(h,l,u,p,s[f+9],12,-1958414417),p=v(p,h,l,u,s[f+10],17,-42063),u=v(u,p,h,l,s[f+11],22,-1990404162),l=v(l,u,p,h,s[f+12],7,1804603682),h=v(h,l,u,p,s[f+13],12,-40341101),p=v(p,h,l,u,s[f+14],17,-1502002290),u=v(u,p,h,l,s[f+15],22,1236535329),l=d(l,u,p,h,s[f+1],5,-165796510),h=d(h,l,u,p,s[f+6],9,-1069501632),p=d(p,h,l,u,s[f+11],14,643717713),u=d(u,p,h,l,s[f+0],20,-373897302),l=d(l,u,p,h,s[f+5],5,-701558691),h=d(h,l,u,p,s[f+10],9,38016083),p=d(p,h,l,u,s[f+15],14,-660478335),u=d(u,p,h,l,s[f+4],20,-405537848),l=d(l,u,p,h,s[f+9],5,568446438),h=d(h,l,u,p,s[f+14],9,-1019803690),p=d(p,h,l,u,s[f+3],14,-187363961),u=d(u,p,h,l,s[f+8],20,1163531501),l=d(l,u,p,h,s[f+13],5,-1444681467),h=d(h,l,u,p,s[f+2],9,-51403784),p=d(p,h,l,u,s[f+7],14,1735328473),u=d(u,p,h,l,s[f+12],20,-1926607734),l=g(l,u,p,h,s[f+5],4,-378558),h=g(h,l,u,p,s[f+8],11,-2022574463),p=g(p,h,l,u,s[f+11],16,1839030562),u=g(u,p,h,l,s[f+14],23,-35309556),l=g(l,u,p,h,s[f+1],4,-1530992060),h=g(h,l,u,p,s[f+4],11,1272893353),p=g(p,h,l,u,s[f+7],16,-155497632),u=g(u,p,h,l,s[f+10],23,-1094730640),l=g(l,u,p,h,s[f+13],4,681279174),h=g(h,l,u,p,s[f+0],11,-358537222),p=g(p,h,l,u,s[f+3],16,-722521979),u=g(u,p,h,l,s[f+6],23,76029189),l=g(l,u,p,h,s[f+9],4,-640364487),h=g(h,l,u,p,s[f+12],11,-421815835),p=g(p,h,l,u,s[f+15],16,530742520),u=g(u,p,h,l,s[f+2],23,-995338651),l=_(l,u,p,h,s[f+0],6,-198630844),h=_(h,l,u,p,s[f+7],10,1126891415),p=_(p,h,l,u,s[f+14],15,-1416354905),u=_(u,p,h,l,s[f+5],21,-57434055),l=_(l,u,p,h,s[f+12],6,1700485571),h=_(h,l,u,p,s[f+3],10,-1894986606),p=_(p,h,l,u,s[f+10],15,-1051523),u=_(u,p,h,l,s[f+1],21,-2054922799),l=_(l,u,p,h,s[f+8],6,1873313359),h=_(h,l,u,p,s[f+15],10,-30611744),p=_(p,h,l,u,s[f+6],15,-1560198380),u=_(u,p,h,l,s[f+13],21,1309151649),l=_(l,u,p,h,s[f+4],6,-145523070),h=_(h,l,u,p,s[f+11],10,-1120210379),p=_(p,h,l,u,s[f+2],15,718787259),u=_(u,p,h,l,s[f+9],21,-343485551),l=l+m>>>0,u=u+b>>>0,p=p+y>>>0,h=h+k>>>0}return e.endian([l,u,p,h])};o._ff=function(t,e,a,n,i,r,o){var s=t+(e&a|~e&n)+(i>>>0)+o;return(s<<r|s>>>32-r)+e},o._gg=function(t,e,a,n,i,r,o){var s=t+(e&n|a&~n)+(i>>>0)+o;return(s<<r|s>>>32-r)+e},o._hh=function(t,e,a,n,i,r,o){var s=t+(e^a^n)+(i>>>0)+o;return(s<<r|s>>>32-r)+e},o._ii=function(t,e,a,n,i,r,o){var s=t+(a^(e|~n))+(i>>>0)+o;return(s<<r|s>>>32-r)+e},o._blocksize=16,o._digestsize=16,t.exports=function(t,a){if(void 0===t||null===t)throw new Error("Illegal argument "+t);var n=e.wordsToBytes(o(t,a));return a&&a.asBytes?n:a&&a.asString?r.bytesToString(n):e.bytesToHex(n)}})()},9643:function(t,e,a){"use strict";var n=a("e29e"),i=a.n(n);i.a},"9a63":function(t,e){var a={utf8:{stringToBytes:function(t){return a.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(a.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],a=0;a<t.length;a++)e.push(255&t.charCodeAt(a));return e},bytesToString:function(t){for(var e=[],a=0;a<t.length;a++)e.push(String.fromCharCode(t[a]));return e.join("")}}};t.exports=a},a010:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Alert",{attrs:{"show-icon":""}},[t._v('需要监控存活的 APP, 在APP管理中选择"监控（是）"，并且填写对应的监控地址。')]),a("Row",{attrs:{gutter:-10}},[a("Col",{attrs:{span:"5"}},[a("Menu",{staticClass:"container",attrs:{"active-name":t.envActive,width:"210"},on:{"on-select":t.selectEnv}},[a("MenuGroup",{attrs:{title:"环境选择"}},t._l(t.envList,function(e){return a("MenuItem",{key:e,attrs:{name:e}},[a("Icon",{attrs:{type:"ios-bookmark"}}),t._v("\n              "+t._s(e)+"\n            ")],1)}))],1)],1),a("Col",{attrs:{span:"19"}},[a("Card",{staticClass:"container"},[a("p",{staticStyle:{height:"18px"},attrs:{slot:"title"},slot:"title"},[t._v("\n          "+t._s(t.envActive)+"\n          "),a("span",{staticStyle:{"margin-left":"20px"}},[a("span",{staticStyle:{color:"#67C23A","margin-right":"5px"}},[t._v(t._s(t.tacticsData.success))]),a("span",{staticStyle:{color:"#F56C6C","margin-right":"5px"}},[t._v(t._s(t.tacticsData.failed))]),a("span",{staticStyle:{color:"#909399","margin-right":"5px"}},[t._v(t._s(t.tacticsData.unreachable))])]),a("a",{staticStyle:{float:"right","font-size":"12px"},on:{click:t.refreshPage}},[t._v("刷新")])]),a("span",{staticStyle:{"font-size":"12px","margin-right":"5px"}},[t._v("告警(统一开关): ")]),a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"default",size:"small"},on:{click:function(e){t.alarmSwitch(1)}}},[t._v("开")]),a("Button",{attrs:{type:"default",size:"small"},on:{click:function(e){t.alarmSwitch(0)}}},[t._v("关")]),a("br"),a("br"),a("Table",{attrs:{loading:t.tableLoading,columns:t.tableColunm,data:t.tableData},on:{"on-sort-change":t.tableSort}})],1)],1)],1),a("Modal",{attrs:{title:"APP Alive 监控图",width:"760"},model:{value:t.monitorModal,callback:function(e){t.monitorModal=e},expression:"monitorModal"}},[a("Alert",{attrs:{type:"warning","show-icon":""}},[t._v("0: 正常, 1: 异常, 2: 不可达")]),a("div",{ref:"appAliveChart",staticStyle:{height:"300px",width:"100%"}})],1)],1)},i=[],r=(a("ac6a"),a("66df")),o=a("6821f"),s={pp:o("app_aliveMonitor")},c=function(){return r["a"].request({url:"/api/v1/common/setting/cmdb/",method:"get",headers:s})},l=function(){return r["a"].request({url:"/api/v1/app/detail/",method:"get",headers:s})},u=function(t){return r["a"].request({url:"/api/v1/monitor/app/alive-data/latest/",method:"post",data:{http_method:"GET",data:t},headers:s})},p=function(t){return r["a"].request({url:"/api/v1/app/alive/urlooker/1/",method:"put",data:t,headers:s})},h=function(t){return r["a"].request({url:"/api/v1/monitor/app/tactics/",method:"post",data:{http_method:"GET",data:t},headers:s})},f=function(t,e,a){return r["a"].request({url:"/api/v1/monitor/app/alive-graph/".concat(t,"/?env=").concat(e,"&check_api=").concat(a),method:"get"})},v=a("c276"),d=a("90de"),g=a("313e"),_=a.n(g),m={name:"app_aliveMonitor",watch:{envActive:function(t,e){this.genCheckAliveList()}},data:function(){var t=this;return{tableLoading:!1,monitorModal:!1,tacticsData:{success:0,failed:0,unreachable:0},originTableData:[],envActive:"",envList:[],tableColunm:[{title:"App 名称",key:"app_name",width:150,sortable:!0,render:function(e,a){return e("a",{on:{click:function(){var e=a.row.app_id,n=a.row.app_name,i={name:"apps_app_detail",params:{id:e},query:{app_name:n}};t.$router.push(i)}}},a.row.app_name)}},{title:"状态",key:"alive_data",width:100,sortable:"custom",sortType:"desc",render:function(t,e){var a=e.row.alive_data.value,n="#909399",i="ios-remove-circle-outline";switch(a){case 0:n="#67C23A",i="md-checkmark-circle-outline";break;case 1:n="#F56C6C",i="ios-close-circle-outline";break}return t("Icon",{props:{type:i},style:{color:n,"font-size":"20px"}})}},{title:"API",key:"check_api",width:250},{title:"更新时间",key:"update_time",align:"center",render:function(t,e){var a=e.row.alive_data.timestamp,n=Object(d["b"])(a,"year");return t("p",{},n)},width:150},{title:"监控",key:"monitor",width:100,align:"center",render:function(e,a){return e("a",{},[e("Icon",{props:{type:"ios-stats"},style:{"font-size":"20px"},on:{click:function(){t.monitorModal=!0;var e=a.row.app_id,n=a.row.env,i=a.row.check_api;f(e,n,i).then(function(e){var a=e.data[0],n=[],i=a.values.map(function(t){return n.push(t.value),Object(d["b"])(t.timestamp,"year")}),r={type:"line",name:"app_alive",data:n};t.singleLineChart(i,r,"appAliveChart","app_alive")}).catch(function(t){Object(v["s"])("error",t)})}}})])}},{title:"告警",key:"is_alarm",align:"center",render:function(e,a){var n;return n=1===a.row.is_alarm,e("i-switch",{props:{value:n},on:{"on-change":function(e){var n={app_id:a.row.app_id,env:a.row.env,is_alarm:e?1:0,check_api:a.row.check_api};p(n).then(function(e){t.$Message.success("操作成功")}).catch(function(t){Object(v["s"])("error",t)})}}})}}],tableData:[],checkAliveList:[]}},methods:{singleLineChart:function(t,e,a,n){var i=this.$refs[a],r={title:{x:"left"},dataZoom:[{type:"slider",show:!1,start:0,end:100},{type:"inside",start:1,end:10},{type:"slider",show:!1,filterMode:"empty",width:12,handleSize:8,showDataShadow:!1,left:"100%"}],tooltip:{trigger:"axis"},legend:{data:n},xAxis:{type:"category",data:t},yAxis:{type:"value"},series:e},o=_.a.init(i);o.setOption(r)},selectEnv:function(t){this.envActive=t},getAppList:function(){var t=this;l().then(function(e){t.originTableData=e.data.filter(function(t){if(t.is_monitor)return t}),t.envActive=t.envList[0]}).catch(function(t){Object(v["s"])("error",t)})},refreshPage:function(){var t=this;l().then(function(e){t.originTableData=e.data.filter(function(t){if(t.is_monitor)return t}),t.genCheckAliveList()}).catch(function(t){Object(v["s"])("error",t)})},genCheckAliveList:function(){var t=this;for(var e in this.tableLoading=!0,this.checkAliveList=[],this.originTableData){var a=this.originTableData[e];if("external"===this.envActive&&a.external_check_api)this.checkAliveList.push({app_name:a.app_name,app_id:a.id,env:this.envActive,is_alarm:a.is_alarm,check_api:a.external_check_api});else{var n=a.host_list[this.envActive];for(var i in n){var r=n[i];r.internal_check_api&&this.checkAliveList.push({app_name:a.app_name,app_id:a.id,env:this.envActive,is_alarm:a.is_alarm,check_api:r.internal_check_api})}}}var o=JSON.stringify(this.checkAliveList);u(o).then(function(e){t.tableData=e.data,t.tableSort({key:"alive_data",order:"desc"}),t.tableLoading=!1}).catch(function(e){Object(v["s"])("error",e),t.tableLoading=!1}),h(o).then(function(e){t.tacticsData=e.data}).catch(function(t){Object(v["s"])("error",t)})},alarmSwitch:function(t){var e=this;for(var a in this.tableData){var n=this.tableData[a],i={app_id:n.app_id,env:n.env,is_alarm:t,check_api:n.check_api};p(i).then(function(t){e.$Message.success("操作成功")}).catch(function(t){Object(v["s"])("error",t)})}this.refreshPage()},tableSort:function(t){if("alive_data"===t.key){var e=[],a=[],n=[];this.tableData.forEach(function(t){switch(t.alive_data.value){case 0:n.push(t);break;case 1:a.push(t);break;default:e.push(t);break}}),"desc"===t.order?this.tableData=e.concat(a,n):this.tableData=n.concat(a,e)}}},created:function(){var t=this;c().then(function(e){t.envList=e.data[0]["cmdb_setting"]["base"]["env"],t.envList=t.envList.filter(function(t){if("undefined"!==t)return t})}).catch(function(t){Object(v["s"])("error",t)}),this.getAppList()},mounted:function(){}},b=m,y=(a("9643"),a("2877")),k=Object(y["a"])(b,n,i,!1,null,null,null);k.options.__file="app_alive_monitor.vue";e["default"]=k.exports},e29e:function(t,e,a){}}]);