(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5406be78"],{"00d87":function(t,e){(function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&a.rotl(t,8)|4278255360&a.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=a.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],a=0,r=0;a<t.length;a++,r+=8)e[r>>>5]|=t[a]<<24-r%32;return e},wordsToBytes:function(t){for(var e=[],a=0;a<32*t.length;a+=8)e.push(t[a>>>5]>>>24-a%32&255);return e},bytesToHex:function(t){for(var e=[],a=0;a<t.length;a++)e.push((t[a]>>>4).toString(16)),e.push((15&t[a]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],a=0;a<t.length;a+=2)e.push(parseInt(t.substr(a,2),16));return e},bytesToBase64:function(t){for(var a=[],r=0;r<t.length;r+=3)for(var n=t[r]<<16|t[r+1]<<8|t[r+2],s=0;s<4;s++)8*r+6*s<=8*t.length?a.push(e.charAt(n>>>6*(3-s)&63)):a.push("=");return a.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var a=[],r=0,n=0;r<t.length;n=++r%4)0!=n&&a.push((e.indexOf(t.charAt(r-1))&Math.pow(2,-2*n+8)-1)<<2*n|e.indexOf(t.charAt(r))>>>6-2*n);return a}};t.exports=a})()},"6821f":function(t,e,a){(function(){var e=a("00d87"),r=a("9a63").utf8,n=a("044b"),s=a("9a63").bin,o=function(t,a){t.constructor==String?t=a&&"binary"===a.encoding?s.stringToBytes(t):r.stringToBytes(t):n(t)?t=Array.prototype.slice.call(t,0):Array.isArray(t)||(t=t.toString());for(var i=e.bytesToWords(t),c=8*t.length,l=1732584193,d=-271733879,u=-1732584194,m=271733878,p=0;p<i.length;p++)i[p]=16711935&(i[p]<<8|i[p]>>>24)|4278255360&(i[p]<<24|i[p]>>>8);i[c>>>5]|=128<<c%32,i[14+(c+64>>>9<<4)]=c;var h=o._ff,f=o._gg,_=o._hh,g=o._ii;for(p=0;p<i.length;p+=16){var v=l,y=d,b=u,w=m;l=h(l,d,u,m,i[p+0],7,-680876936),m=h(m,l,d,u,i[p+1],12,-389564586),u=h(u,m,l,d,i[p+2],17,606105819),d=h(d,u,m,l,i[p+3],22,-1044525330),l=h(l,d,u,m,i[p+4],7,-176418897),m=h(m,l,d,u,i[p+5],12,1200080426),u=h(u,m,l,d,i[p+6],17,-1473231341),d=h(d,u,m,l,i[p+7],22,-45705983),l=h(l,d,u,m,i[p+8],7,1770035416),m=h(m,l,d,u,i[p+9],12,-1958414417),u=h(u,m,l,d,i[p+10],17,-42063),d=h(d,u,m,l,i[p+11],22,-1990404162),l=h(l,d,u,m,i[p+12],7,1804603682),m=h(m,l,d,u,i[p+13],12,-40341101),u=h(u,m,l,d,i[p+14],17,-1502002290),d=h(d,u,m,l,i[p+15],22,1236535329),l=f(l,d,u,m,i[p+1],5,-165796510),m=f(m,l,d,u,i[p+6],9,-1069501632),u=f(u,m,l,d,i[p+11],14,643717713),d=f(d,u,m,l,i[p+0],20,-373897302),l=f(l,d,u,m,i[p+5],5,-701558691),m=f(m,l,d,u,i[p+10],9,38016083),u=f(u,m,l,d,i[p+15],14,-660478335),d=f(d,u,m,l,i[p+4],20,-405537848),l=f(l,d,u,m,i[p+9],5,568446438),m=f(m,l,d,u,i[p+14],9,-1019803690),u=f(u,m,l,d,i[p+3],14,-187363961),d=f(d,u,m,l,i[p+8],20,1163531501),l=f(l,d,u,m,i[p+13],5,-1444681467),m=f(m,l,d,u,i[p+2],9,-51403784),u=f(u,m,l,d,i[p+7],14,1735328473),d=f(d,u,m,l,i[p+12],20,-1926607734),l=_(l,d,u,m,i[p+5],4,-378558),m=_(m,l,d,u,i[p+8],11,-2022574463),u=_(u,m,l,d,i[p+11],16,1839030562),d=_(d,u,m,l,i[p+14],23,-35309556),l=_(l,d,u,m,i[p+1],4,-1530992060),m=_(m,l,d,u,i[p+4],11,1272893353),u=_(u,m,l,d,i[p+7],16,-155497632),d=_(d,u,m,l,i[p+10],23,-1094730640),l=_(l,d,u,m,i[p+13],4,681279174),m=_(m,l,d,u,i[p+0],11,-358537222),u=_(u,m,l,d,i[p+3],16,-722521979),d=_(d,u,m,l,i[p+6],23,76029189),l=_(l,d,u,m,i[p+9],4,-640364487),m=_(m,l,d,u,i[p+12],11,-421815835),u=_(u,m,l,d,i[p+15],16,530742520),d=_(d,u,m,l,i[p+2],23,-995338651),l=g(l,d,u,m,i[p+0],6,-198630844),m=g(m,l,d,u,i[p+7],10,1126891415),u=g(u,m,l,d,i[p+14],15,-1416354905),d=g(d,u,m,l,i[p+5],21,-57434055),l=g(l,d,u,m,i[p+12],6,1700485571),m=g(m,l,d,u,i[p+3],10,-1894986606),u=g(u,m,l,d,i[p+10],15,-1051523),d=g(d,u,m,l,i[p+1],21,-2054922799),l=g(l,d,u,m,i[p+8],6,1873313359),m=g(m,l,d,u,i[p+15],10,-30611744),u=g(u,m,l,d,i[p+6],15,-1560198380),d=g(d,u,m,l,i[p+13],21,1309151649),l=g(l,d,u,m,i[p+4],6,-145523070),m=g(m,l,d,u,i[p+11],10,-1120210379),u=g(u,m,l,d,i[p+2],15,718787259),d=g(d,u,m,l,i[p+9],21,-343485551),l=l+v>>>0,d=d+y>>>0,u=u+b>>>0,m=m+w>>>0}return e.endian([l,d,u,m])};o._ff=function(t,e,a,r,n,s,o){var i=t+(e&a|~e&r)+(n>>>0)+o;return(i<<s|i>>>32-s)+e},o._gg=function(t,e,a,r,n,s,o){var i=t+(e&r|a&~r)+(n>>>0)+o;return(i<<s|i>>>32-s)+e},o._hh=function(t,e,a,r,n,s,o){var i=t+(e^a^r)+(n>>>0)+o;return(i<<s|i>>>32-s)+e},o._ii=function(t,e,a,r,n,s,o){var i=t+(a^(e|~r))+(n>>>0)+o;return(i<<s|i>>>32-s)+e},o._blocksize=16,o._digestsize=16,t.exports=function(t,a){if(void 0===t||null===t)throw new Error("Illegal argument "+t);var r=e.wordsToBytes(o(t,a));return a&&a.asBytes?r:a&&a.asString?s.bytesToString(r):e.bytesToHex(r)}})()},8855:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Alert",{attrs:{"show-icon":"",closable:""}},[t._v("数据源: "),a("a",{attrs:{href:"http://kibana.aiyuangong.com",target:"_blank"}},[t._v("http://kibana.aiyuangong.com ")]),t._v(" , es index: plog-callchain*")]),a("Card",{directives:[{name:"show",rawName:"v-show",value:t.showCreateTab,expression:"showCreateTab"}],staticStyle:{"margin-bottom":"10px"}},[t.createTabSpin?a("Spin",{attrs:{size:"large",fix:""}}):t._e(),a("p",{attrs:{slot:"title"},slot:"title"},[t._v("添加策略")]),a("Form",{ref:"dataForm",attrs:{model:t.dataForm,rules:t.ruleDataForm,inline:""}},[a("Row",[a("Col",{attrs:{span:"24"}},[a("FormItem",{attrs:{prop:"alarm_name"}},[a("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"监控名"},model:{value:t.dataForm.alarm_name,callback:function(e){t.$set(t.dataForm,"alarm_name","string"===typeof e?e.trim():e)},expression:"dataForm.alarm_name"}})],1),a("FormItem",{attrs:{prop:"where_condition"}},[a("Input",{staticStyle:{width:"500px"},attrs:{placeholder:'API 匹配条件 {"http_host": "www.tokenworld.pro"}'},model:{value:t.dataForm.where_condition,callback:function(e){t.$set(t.dataForm,"where_condition","string"===typeof e?e.trim():e)},expression:"dataForm.where_condition"}})],1),a("FormItem",[a("InputNumber",{staticStyle:{width:"100px"},attrs:{formatter:function(t){return"最近 "+t+" 分钟"},placeholder:"最近几分钟"},model:{value:t.dataForm.latest_time,callback:function(e){t.$set(t.dataForm,"latest_time",e)},expression:"dataForm.latest_time"}})],1),a("Tooltip",{attrs:{"max-width":"400",placement:"bottom"}},[a("Icon",{staticStyle:{"font-size":"20px",color:"#2d8cf0",cursor:"pointer"},attrs:{type:"ios-alert-outline"}}),a("div",{attrs:{slot:"content"},slot:"content"},[a("p",[t._v("可匹配字段:")]),a("p",[t._v("server,requestsize,sessionid,responsesize,cspanid,requestid")]),a("p",[t._v("envtype,pspanid,responsecode,cost,logname,requestip,url,")]),a("p",[t._v("success, loglevel, appid")]),a("p",[t._v("以上字段均为string，匹配字段不存在请联系管理员")])])],1)],1)],1),a("Row",[a("Col",{attrs:{span:"24"}},[a("FormItem",[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"策略"},model:{value:t.dataForm.alarm_strategy,callback:function(e){t.$set(t.dataForm,"alarm_strategy",e)},expression:"dataForm.alarm_strategy"}},t._l(t.strategyList,function(e){return a("Option",{key:e.strategy,attrs:{value:e.strategy}},[t._v(t._s(e.comment))])}))],1),a("FormItem",[a("b",[t._v("IF")])]),a("FormItem",[a("Select",{staticStyle:{width:"70px"},attrs:{placeholder:"比较符"},model:{value:t.dataForm.op,callback:function(e){t.$set(t.dataForm,"op",e)},expression:"dataForm.op"}},t._l(t.opList,function(e){return a("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}))],1),a("FormItem",[a("Input-number",{staticStyle:{width:"100px"},attrs:{placeholder:"告警值",formatter:function(t){return t+" ms"}},model:{value:t.dataForm.cost,callback:function(e){t.$set(t.dataForm,"cost",e)},expression:"dataForm.cost"}})],1),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:"cost_percent"===t.dataForm.alarm_strategy,expression:"dataForm.alarm_strategy === 'cost_percent'"}]},[a("InputNumber",{staticStyle:{width:"150px"},attrs:{max:100,min:1,placeholder:"百分比(number)",formatter:function(e){return"占比  "+t.dataForm.op+"  "+e+"%"}},model:{value:t.dataForm.strategy_external.percent,callback:function(e){t.$set(t.dataForm.strategy_external,"percent",e)},expression:"dataForm.strategy_external.percent"}})],1)],1)],1),a("Row",[a("Col",{attrs:{span:"24"}},[a("FormItem",{attrs:{prop:"send_user_id"}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"发送用户",multiple:"",filterable:""},model:{value:t.dataForm.send_user_id,callback:function(e){t.$set(t.dataForm,"send_user_id",e)},expression:"dataForm.send_user_id"}},t._l(t.sendUseIdList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.real_name))])}))],1),a("FormItem",[a("Checkbox",{model:{value:t.dataForm.is_mail,callback:function(e){t.$set(t.dataForm,"is_mail",e)},expression:"dataForm.is_mail"}},[t._v("邮件")]),a("Checkbox",{attrs:{disabled:""},model:{value:t.dataForm.is_message,callback:function(e){t.$set(t.dataForm,"is_message",e)},expression:"dataForm.is_message"}},[t._v("短信")]),a("Checkbox",{attrs:{disabled:""},model:{value:t.dataForm.is_wechat,callback:function(e){t.$set(t.dataForm,"is_wechat",e)},expression:"dataForm.is_wechat"}},[t._v("微信")])],1)],1)],1),a("Row",[a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"default"},on:{click:function(){t.showCreateTab=!1}}},[t._v("关闭")]),a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.saveStrategy}},[a("Icons",{attrs:{type:"save",size:10,color:"#2d8cf0"}}),t._v(" 保存")],1)],1)],1)],1),a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("策略表")]),a("Poptip",{staticStyle:{"margin-bottom":"20px","margin-right":"10px"},attrs:{confirm:"",title:"确认删除 ？",placement:"right-start"},on:{"on-ok":t.deleteItem}},[a("Button",{attrs:{type:"default",size:"small"}},[t._v("删除")])],1),a("Button",{attrs:{type:"primary",size:"small",ghost:""},on:{click:t.createStrategy}},[t._v("创建策略")]),a("Input",{staticStyle:{width:"200px",float:"right"},attrs:{placeholder:"匹配条件",search:""},on:{"on-keyup":function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.search(e):null}},model:{value:t.searchVal,callback:function(e){t.searchVal="string"===typeof e?e.trim():e},expression:"searchVal"}}),a("Dropdown",{staticStyle:{"margin-right":"10px",float:"right"},attrs:{trigger:"click"},on:{"on-click":t.patchAlarmOnOff}},[a("Button",{attrs:{type:"primary",ghost:""}},[t._v("\n        批量开关\n        "),a("Icon",{attrs:{type:"ios-arrow-down"}})],1),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("DropdownItem",{attrs:{name:"on"}},[t._v("开")]),a("DropdownItem",{attrs:{name:"off"}},[t._v("关")])],1)],1),a("Table",{attrs:{loading:t.tableLoading,columns:t.tableColumns,data:t.tableDatas},on:{"on-selection-change":t.selectChange}})],1),a("Modal",{attrs:{title:"修改发送人"},on:{"on-ok":t.modifySendUser},model:{value:t.alarmPersonModal,callback:function(e){t.alarmPersonModal=e},expression:"alarmPersonModal"}},[a("Form",[a("FormItem",{attrs:{label:"发送人: "}},[a("Select",{staticStyle:{width:"300px"},attrs:{placeholder:"发送用户",multiple:"",filterable:""},model:{value:t.mSendUserIdList,callback:function(e){t.mSendUserIdList=e},expression:"mSendUserIdList"}},t._l(t.sendUseIdList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.real_name))])}))],1)],1)],1)],1)},n=[],s=(a("ac6a"),a("53ca")),o=a("83ae"),i=a("c276"),c=a("66df"),l=a("6821f"),d={pp:l("monitor_business_apiQuality")},u=function(){return c["a"].request({url:"/api/v1/users/open/",method:"get",headers:d})},m=function(){return c["a"].request({url:"/api/v1/business/access-alarm/strategy/",method:"get",headers:d})},p=function(t){return c["a"].request({url:"/api/v1/business/access-alarm/strategy/",method:"post",data:t,headers:d})},h=function(t,e){return c["a"].request({url:"/api/v1/business/access-alarm/strategy/".concat(t,"/"),method:"patch",data:e,headers:d})},f=function(t){return c["a"].request({url:"/api/v1/business/access-alarm/strategy/".concat(t,"/"),method:"delete",headers:d})},_={name:"monitor_business_apiQuality",components:{Icons:o["a"]},data:function(){var t=this,e=function(t,e,a){try{var r=JSON.parse(e);"object"!==Object(s["a"])(r)&&a(new Error('请输入 JSON 格式, 如 {"appid": "dlvopenapi", "url": "/dlvopenapi/apixxx"}')),a()}catch(n){a(new Error('请输入 JSON 格式, 如 {"appid": "dlvopenapi", "url": "/dlvopenapi/apixxx"}'))}};return{mSendUserId:[],mSendUserIdList:[],alarmPersonModal:!1,selectValues:[],searchVal:"",createTabSpin:!1,showCreateTab:!1,tableColumns:[{type:"selection",width:50,align:"left"},{title:"Ops Id",key:"work_order",sortable:!0,sortType:"desc",width:130},{title:"监控名",key:"alarm_name"},{title:"匹配条件",key:"where_condition"},{title:"策略",width:180,render:function(t,e){var a=JSON.parse(e.row.alarm_strategy),r=a["strategy"],n=e.row.op,s=e.row.cost;switch(r){case"cost_percent":var o=a["percent"];return t("span",{},[t("p",{},"[".concat(r,"]")),t("p",{},"if ".concat(n," ").concat(s,"; 占比 ").concat(n," ").concat(100*o,"% "))]);default:return t("span",{},[t("p",{},"[".concat(r,"]")),t("p",{},"if ".concat(n," ").concat(s,";"))])}}},{title:"最近",key:"latest_time",width:80,align:"center",render:function(t,e){return t("span",{},"".concat(e.row.latest_time," 分钟"))}},{title:"发送人",render:function(e,a){var r=JSON.parse(a.row.send_user_id),n=[];return t.sendUseIdList.forEach(function(t){-1!==r.indexOf(t.id)&&n.push(e("p",{},t.real_name))}),e("div",{},n)}},{title:"发送方式",width:120,render:function(t,e){var a,r=[e.row.is_mail,e.row.is_message,e.row.is_wechat];return r[0]&&(a=" 邮箱 "),r[1]&&(a+=" 短信 "),r[2]&&(a+=" 微信 "),t("span",{},a)}},{title:"操作 | 告警",align:"center",width:120,render:function(e,a){return e("div",{},[e("a",{on:{click:function(){t.alarmPersonModal=!0,t.mSendUserId=a.row.id,t.mSendUserIdList=JSON.parse(a.row.send_user_id)}},style:{"margin-right":"10px"}},"发送人"),e("i-switch",{props:{value:a.row.is_alarm,size:"small"},on:{"on-change":function(e){var r=e?1:0;h(a.row.id,{is_alarm:r}).then(function(e){t.$Message.success("On/Off 告警")}).catch(function(t){Object(i["s"])("error",t)})}}})])}}],tableLoading:!1,tableDatas:[],originTableDatas:[],sendUseIdList:[],opList:[">",">=","==","<=","<"],strategyList:[{strategy:"average",comment:"平均值 (average)"},{strategy:"max",comment:"最大值 (max)"},{strategy:"cost_percent",comment:"花费占比 (cost_percent)"}],strategyExternal:{percent:0},dataForm:{alarm_name:"",where_condition:"",alarm_strategy:"average",latest_time:1,is_mail:!1,is_message:!1,is_wechat:!1,op:">",cost:1e3,is_alarm:1,send_user_id:[],strategy_external:{percent:50}},initDataForm:{alarm_name:"",where_condition:"",alarm_strategy:"average",latest_time:1,is_mail:!1,is_message:!1,is_wechat:!1,op:">",cost:1e3,is_alarm:1,send_user_id:[],strategy_external:{percent:50}},ruleDataForm:{alarm_name:[{required:!0,message:"不能为空",trigger:"blur"}],where_condition:[{required:!0,validator:e,trigger:"blur"}],send_user_id:[{required:!0,type:"array",message:"不能为空",trigger:"change"}]}}},methods:{search:function(){var t=this;this.searchVal?this.tableDatas=this.originTableDatas.filter(function(e){if(-1!==e.where_condition.indexOf(t.searchVal))return e}):this.tableDatas=this.originTableDatas},reloadTable:function(){var t=this;this.tableLoading=!0,m().then(function(e){t.tableDatas=t.originTableDatas=e.data,console.log(t.tableDatas),t.tableLoading=!1}).catch(function(e){Object(i["s"])("error",e),t.tableLoading=!1})},selectChange:function(t){this.selectValues=t},deleteItem:function(){var t=this;this.selectValues.forEach(function(e){f(e.id).then(function(e){t.$Message.success("删除成功"),t.reloadTable()}).catch(function(t){Object(i["s"])("error",t)})})},modifySendUser:function(){var t=this;h(this.mSendUserId,{send_user_id:JSON.stringify(this.mSendUserIdList)}).then(function(e){t.$Message.success("操作成功"),t.reloadTable()}).catch(function(t){Object(i["s"])("error",t)})},createStrategy:function(){this.showCreateTab=!0},patchAlarmOnOff:function(t){var e=this,a="on"===t?1:0;this.originTableDatas.forEach(function(t){h(t.id,{is_alarm:a}).then(function(t){e.$Message.success("On/Off 告警")}).catch(function(t){Object(i["s"])("error",t)})}),setTimeout(function(){e.reloadTable()},2e3)},saveStrategy:function(){var t=this;this.$refs["dataForm"].validate(function(e){if(e){var a;t.createTabSpin=!0;var r=t.dataForm.alarm_strategy;switch(r){case"cost_percent":a='{"strategy": "'.concat(r,'", "percent": ').concat(t.dataForm.strategy_external.percent/100,"}");break;default:a='{"strategy": "'.concat(r,'"}');break}var n={alarm_name:t.dataForm.alarm_name,where_condition:t.dataForm.where_condition,alarm_strategy:a,latest_time:t.dataForm.latest_time,is_mail:t.dataForm.is_mail?1:0,is_message:t.dataForm.is_message?1:0,is_wechat:t.dataForm.is_wechat?1:0,op:">",cost:t.dataForm.cost,is_alarm:1,send_user_id:JSON.stringify(t.dataForm.send_user_id)};console.log(n),p(n).then(function(e){t.$Message.success("创建成功"),t.reloadTable(),t.showCreateTab=!1,t.createTabSpin=!1}).catch(function(e){Object(i["s"])("error",e),t.createTabSpin=!1})}else t.$Message.error("信息不完整")})}},mounted:function(){var t=this;u().then(function(e){t.sendUseIdList=e.data}).catch(function(t){Object(i["s"])("error",t)}),this.reloadTable()}},g=_,v=a("2877"),y=Object(v["a"])(g,r,n,!1,null,null,null);y.options.__file="api_quality.vue";e["default"]=y.exports},"9a63":function(t,e){var a={utf8:{stringToBytes:function(t){return a.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(a.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],a=0;a<t.length;a++)e.push(255&t.charCodeAt(a));return e},bytesToString:function(t){for(var e=[],a=0;a<t.length;a++)e.push(String.fromCharCode(t[a]));return e.join("")}}};t.exports=a}}]);